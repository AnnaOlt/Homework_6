<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Favorite Movies</title>
    <style type="text/css">
      button,
      div,
      form,
      input {
        margin: 10px;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <h1>Movie Search</h1>

      <!-- Rendered Buttons will get Dumped Here  -->
      <div id="cities-view"></div>

      <form id="movie-form">
        <label for="movie-input">Add a Movie, Yo!</label>
        <input type="text" id="city-input" /><br />

        <!-- Button triggers new movie to be added -->
        <input id="add-city" type="submit" value="Add a Movie, Yo!" />
      </form>

      <!-- Movies will Get Dumped Here -->
      <div id="cities-view"></div>

      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
      <script type="text/javascript">
        // Initial array of movies
        var cities = [
          "London",
          "Berlin",
          "Stockholm",
          "Dubai"
        ];

        // Function for dumping the JSON content for each button into the div
        function displayMovieInfo() {
          var movie = $(this).attr("data-name");
          var queryURL =
          "https://api.openweathermap.org/data/2.5/weather?q=" + cities + "&apikey=baf28dc2bd487831b9b7128513ed1ae7";

          $.ajax({
            url: queryURL,
            method: "GET"
          }).then(function(response) {
            $("#cities-view").text(JSON.stringify(response));
          });
        }

        // Function for displaying movie data
        function renderButtons() {
          // Deleting the buttons prior to adding new movies
          // (this is necessary otherwise you will have repeat buttons)
          $("#buttons-view").empty();

          // Looping through the array of movies
          for (var i = 0; i < cities.length; i++) {
            // Then dynamically generating buttons for each movie in the array
            // This code $("<button>") is all jQuery needs to create the beginning and end tag. (<button></button>)
            var a = $("<button>");
            // Adding a class of movie to our button
            a.addClass("movie");
            // Adding a data-attribute
            a.attr("data-name", cities[i]);
            // Providing the initial button text
            a.text(cities[i]);
            // Adding the button to the buttons-view div
            $("#buttons-view").append(a);
          }


        // This function handles events where one button is clicked
        $("#add-movie").on("click", function(event) {
          event.preventDefault();

          // This line grabs the input from the textbox
          var cities = $("#movie-input")
            .val()
            .trim();

          // Adding the movie from the textbox to our array
          city.push(city);
          console.log(cities);

          // Calling renderButtons which handles the processing of our movie array
          renderButtons();
        });

        // Function for displaying the movie info
        // Using $(document).on instead of $(".movie").on to add event listeners to dynamically generated elements
        $(document).on("click", ".movie", displayMovieInfo);

        // Calling the renderButtons function to display the initial buttons
        renderButtons();
      </script>
    </div>
  </body>
</html>
